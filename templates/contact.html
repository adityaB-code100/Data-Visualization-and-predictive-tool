<!-- contact.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact Us - Data Visualization Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100">

  <div class="max-w-3xl mx-auto mt-16 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg">
    <h2 class="text-3xl font-bold mb-6 text-center">Contact Us</h2>

    <form id="contactForm" method="POST" action="/contact" class="space-y-4">
      <!-- CSRF token placeholder for Flask-WTF -->
      {{ form.csrf_token }}

      <!-- Full Name -->
      <div>
        <label for="name" class="block mb-1 font-medium">Full Name <span class="text-red-500">*</span></label>
        <input type="text" name="name" id="name" required placeholder="Your full name"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
        <p class="text-red-500 text-sm mt-1 hidden" id="nameError">Please enter your full name.</p>
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block mb-1 font-medium">Email Address <span class="text-red-500">*</span></label>
        <input type="email" name="email" id="email" required placeholder="your@email.com"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
        <p class="text-red-500 text-sm mt-1 hidden" id="emailError">Please enter a valid email.</p>
      </div>

      <!-- Subject / Topic -->
      <div>
        <label for="subject" class="block mb-1 font-medium">Subject / Topic <span class="text-red-500">*</span></label>
        <input type="text" name="subject" id="subject" required placeholder="Enter subject"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
        <p class="text-red-500 text-sm mt-1 hidden" id="subjectError">Please enter a subject.</p>
      </div>

      <!-- Optional: Reason for Contact -->
      <div>
        <label for="reason" class="block mb-1 font-medium">Reason for Contact</label>
        <select name="reason" id="reason"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
          <option value="">Select a reason</option>
          <option value="General Inquiry">General Inquiry</option>
          <option value="Support">Support</option>
          <option value="Partnership">Partnership</option>
          <option value="Feedback">Feedback</option>
        </select>
      </div>

      <!-- Optional: Phone -->
      <div>
        <label for="phone" class="block mb-1 font-medium">Phone Number</label>
        <input type="tel" name="phone" id="phone" placeholder="+1234567890"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
      </div>

      <!-- Optional: Company -->
      <div>
        <label for="company" class="block mb-1 font-medium">Company / Organization</label>
        <input type="text" name="company" id="company" placeholder="Your company"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
      </div>

      <!-- Message -->
      <div>
        <label for="message" class="block mb-1 font-medium">Message <span class="text-red-500">*</span></label>
        <textarea name="message" id="message" rows="5" required placeholder="Write your message here..."
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"></textarea>
        <p class="text-red-500 text-sm mt-1 hidden" id="messageError">Please enter a message.</p>
      </div>

      <!-- Submit Button -->
      <div class="flex items-center justify-between">
        <button type="submit" id="submitBtn"
                class="bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-2 rounded-lg transition relative">
          <span id="btnText">Send Message</span>
          <svg id="loadingSpinner" class="hidden animate-spin h-5 w-5 ml-2 text-white absolute right-4 top-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
          </svg>
        </button>
      </div>

      <!-- Success/Error Message -->
      <p id="formMessage" class="text-center font-medium mt-4 hidden"></p>

      <!-- Optional: reCAPTCHA Placeholder -->
      <!-- <div class="g-recaptcha" data-sitekey="YOUR_SITE_KEY"></div> -->
    </form>
    <a href="/" class="mt-6 inline-block text-cyan-600 hover:underline">‚Üê Back to Home</a>
  </div>

  <!-- JavaScript Validation & AJAX -->
  <script>
    const form = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const formMessage = document.getElementById('formMessage');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Clear previous errors
      document.querySelectorAll('p.text-red-500').forEach(p => p.classList.add('hidden'));
      formMessage.classList.add('hidden');

      // Frontend validation
      let valid = true;
      if (!form.name.value.trim()) { document.getElementById('nameError').classList.remove('hidden'); valid=false; }
      if (!form.email.value.trim() || !/^\S+@\S+\.\S+$/.test(form.email.value)) { document.getElementById('emailError').classList.remove('hidden'); valid=false; }
      if (!form.subject.value.trim()) { document.getElementById('subjectError').classList.remove('hidden'); valid=false; }
      if (!form.message.value.trim()) { document.getElementById('messageError').classList.remove('hidden'); valid=false; }

      if (!valid) return;

      // Show loading spinner
      btnText.classList.add('opacity-0');
      loadingSpinner.classList.remove('hidden');

      // Prepare form data
      const formData = new FormData(form);

      try {
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.status === 'success') {
          formMessage.textContent = data.message;
          formMessage.className = "text-green-600 font-medium mt-4 text-center";
          form.reset();
        } else {
          formMessage.textContent = data.message;
          formMessage.className = "text-red-500 font-medium mt-4 text-center";
        }
        formMessage.classList.remove('hidden');

      } catch (error) {
        formMessage.textContent = "An error occurred. Please try again later.";
        formMessage.className = "text-red-500 font-medium mt-4 text-center";
        formMessage.classList.remove('hidden');
      }

      // Hide spinner
      btnText.classList.remove('opacity-0');
      loadingSpinner.classList.add('hidden');
    });
  </script>
</body>
</html>
